{"version":3,"sources":["../../../src/setup/server/authentication.js"],"names":["request","response","next","header","headers","authentication","token","split","userToken","jwt","verify","SECURITY_SECRET","User","findOne","_id","id","user","auth","isAuthenticated","console","warn"],"mappings":";;;;;;;;;;;;;AACA;;AAGA;;AACA;;AALA;AAGA;AAIA;;;;;;uFACe,iBAAgBA,OAAhB,EAAyBC,QAAzB,EAAmCC,IAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AACTC,YAAAA,MADS,GACAH,OAAO,CAACI,OAAR,CAAgBC,cADhB;;AAAA,kBAGTF,MAAM,IAAIA,MAAM,KAAK,IAHZ;AAAA;AAAA;AAAA;;AAAA;AAKHG,YAAAA,KALG,GAKKH,MAAM,CAACI,KAAP,CAAa,GAAb,CALL;AAMHC,YAAAA,SANG,GAMSC,yBAAIC,MAAJ,CAAWJ,KAAK,CAAC,CAAD,CAAhB,EAAqBK,oBAArB,CANT;AAAA;AAAA,mBAOQC,kBAAKC,OAAL,CAAa;AAAEC,cAAAA,GAAG,EAAEN,SAAS,CAACO;AAAjB,aAAb,CAPR;;AAAA;AAOLC,YAAAA,IAPK;;AAST,gBAAGA,IAAH,EAAS;AACPhB,cAAAA,OAAO,CAACiB,IAAR,GAAe;AACbC,gBAAAA,eAAe,EAAE,IADJ;AAEbF,gBAAAA,IAAI,EAAJA;AAFa,eAAf;AAID;;AAdQ;AAAA;;AAAA;AAAA;AAAA;AAgBTG,YAAAA,OAAO,CAACC,IAAR,CAAa,yBAAb;;AAhBS;AAAA;AAAA;;AAAA;AAmBXpB,YAAAA,OAAO,CAACiB,IAAR,GAAe;AACbC,cAAAA,eAAe,EAAE,KADJ;AAEbF,cAAAA,IAAI,EAAE;AAFO,aAAf;;AAnBW;AAyBbd,YAAAA,IAAI;;AAzBS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["// Imports\r\nimport jwt from 'jsonwebtoken'\r\n\r\n// App Imports\r\nimport { SECURITY_SECRET } from '../config/env'\r\nimport User from '../../modules/user/model'\r\n\r\n// Authentication middleware\r\nexport default async function (request, response, next) {\r\n  let header = request.headers.authentication\r\n\r\n  if (header && header !== null) {\r\n    try {\r\n      const token = header.split(' ')\r\n      const userToken = jwt.verify(token[1], SECURITY_SECRET)\r\n      let user = await User.findOne({ _id: userToken.id })\r\n\r\n      if(user) {\r\n        request.auth = {\r\n          isAuthenticated: true,\r\n          user\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.warn('Invalid token detected.')\r\n    }\r\n  } else {\r\n    request.auth = {\r\n      isAuthenticated: false,\r\n      user: null\r\n    }\r\n  }\r\n\r\n  next()\r\n}\r\n"],"file":"authentication.js"}